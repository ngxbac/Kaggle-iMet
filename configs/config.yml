model_params:
  model: Finetune
  arch: resnet34
  n_class: 1103

args:
  expdir: "src"
  logdir: &logdir "./logs/imet"
  baselogdir: "./logs/imet"


stages:

  state_params:
    main_metric: &reduce_metric fbeta
    minimize_metric: False

  criterion_params:
    criterion: BCEFbetaFocalLoss

  scheduler_params:
    scheduler: StepLR
    step_size: 5
    gamma: 0.1

  data_params:
    batch_size: 32
    num_workers: 4
    drop_last: False

    image_size: &image_size 320
    train_csv: "./imet/csv/kfold6/train_0.csv.gz"
    valid_csv: "./imet/csv/kfold6/valid_0.csv.gz"
    root: "/raid/data/kaggle/imet2019/train/"

  stage1:

    state_params:
      num_epochs: 1

    optimizer_params:
      optimizer: Adam
      lr: 0.001
      weight_decay: 0.0001

    callbacks_params: &callback_params
      loss:
        callback: LossCallback
      optimizer:
        callback: OptimizerCallback
      f1:
        callback: FbetaCallback
      scheduler:
        callback: SchedulerCallback
        reduce_metric: *reduce_metric
      saver:
        callback: CheckpointCallback
        save_n_best: 5

  stage2:

    state_params:
      num_epochs: 9

    optimizer_params:
      optimizer: Adam
      lr: 0.0001
      weight_decay: 0.0001

    callbacks_params: *callback_params